# Toora monorepo — four Railway services sharing one Postgres + one Redis.
# Each service is built from its own subdirectory.

[build]
builder = "dockerfile"

# ── Service 1: Next.js dashboard ──────────────────────────────────────────────
[[services]]
name = "frontend"

[services.build]
buildCommand = "cd frontend && npm ci && npm run build"
builder = "nixpacks"

[services.deploy]
startCommand = "cd frontend && npm run start"
healthcheckPath = "/"
healthcheckTimeout = 30

# ── Service 2: FastAPI backend ─────────────────────────────────────────────────
[[services]]
name = "backend"

[services.source]
rootDirectory = "backend"

[services.build]
builder = "dockerfile"
dockerfilePath = "backend/Dockerfile"

[services.deploy]
startCommand = "uvicorn main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# ── Service 3: LangGraph worker ────────────────────────────────────────────────
[[services]]
name = "worker"

[services.source]
rootDirectory = "worker"

[services.build]
builder = "dockerfile"
dockerfilePath = "worker/Dockerfile"

[services.deploy]
startCommand = "python main.py"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# ── Service 4: Telegram bot webhook ───────────────────────────────────────────
[[services]]
name = "bot"

[services.source]
rootDirectory = "bot"

[services.build]
builder = "dockerfile"
dockerfilePath = "bot/Dockerfile"

[services.deploy]
startCommand = "uvicorn main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3
